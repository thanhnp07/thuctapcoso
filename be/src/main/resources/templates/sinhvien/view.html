<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi tiết sinh viên - QLSV</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    
    <style>
        :root { --sidebar-width: 250px; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        .sidebar {
            position: fixed; top: 0; left: 0; height: 100vh; width: var(--sidebar-width);
            background: linear-gradient(180deg, #1e3c72 0%, #2a5298 100%);
            color: white; padding-top: 20px; z-index: 1000; overflow-y: auto;
        }
        .sidebar .brand { padding: 20px; font-size: 1.5rem; font-weight: bold; text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px; }
        .sidebar .nav-link { color: rgba(255,255,255,0.8); padding: 12px 20px; margin: 5px 15px;
            border-radius: 8px; transition: all 0.3s; }
        .sidebar .nav-link:hover, .sidebar .nav-link.active { background: rgba(255,255,255,0.1); color: white; }
        .sidebar .nav-link i { margin-right: 10px; width: 20px; }
        
        .main-content { margin-left: var(--sidebar-width); padding: 0; min-height: 100vh; background-color: #f8f9fa; }
        .top-navbar { background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); padding: 15px 30px; margin-bottom: 30px; }
        .content-area { padding: 0 30px 30px 30px; }
        
        .detail-card { border: none; border-radius: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .info-row { border-bottom: 1px solid #f0f0f0; padding: 15px 0; }
        .info-row:last-child { border-bottom: none; }
        .info-label { font-weight: 600; color: #666; }
        .profile-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 15px 15px 0 0; }
        .profile-avatar { width: 100px; height: 100px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 3rem; color: #667eea; }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="brand"><i class="bi bi-mortarboard-fill"></i> QLSV</div>
        <nav class="nav flex-column">
            <a class="nav-link" href="/dashboard"><i class="bi bi-speedometer2"></i> Dashboard</a>
            <a class="nav-link active" href="/sinhvien"><i class="bi bi-people-fill"></i> Sinh viên</a>
            <a class="nav-link" href="/khoa"><i class="bi bi-building"></i> Khoa</a>
            <a class="nav-link" href="/lop"><i class="bi bi-book"></i> Lớp</a>
        </nav>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <div class="top-navbar d-flex justify-content-between align-items-center">
            <h4 class="mb-0">Chi tiết sinh viên</h4>
            <div class="d-flex align-items-center">
                <span class="me-3" sec:authentication="name">Admin</span>
                <form th:action="@{/logout}" method="post" class="d-inline">
                    <button type="submit" class="btn btn-outline-danger btn-sm">
                        <i class="bi bi-box-arrow-right"></i> Đăng xuất
                    </button>
                </form>
            </div>
        </div>
        
        <div class="content-area">
            <div class="card detail-card">
                <!-- Profile Header -->
                <div class="profile-header">
                    <div class="d-flex align-items-center">
                        <div class="profile-avatar me-4">
                            <i class="bi bi-person-fill"></i>
                        </div>
                        <div>
                            <h3 class="mb-1" th:text="${sinhVien.hoTen}">Nguyễn Văn A</h3>
                            <p class="mb-0 opacity-75">
                                <i class="bi bi-card-text me-2"></i><span th:text="${sinhVien.maSV}">SV001</span> | 
                                <i class="bi bi-envelope ms-3 me-2"></i><span th:text="${sinhVien.email}">email@example.com</span>
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Detail Content -->
                <div class="card-body p-4">
                    <div class="row">
                        <div class="col-md-6">
                            <h5 class="mb-3"><i class="bi bi-info-circle me-2"></i>Thông tin cá nhân</h5>
                            
                            <div class="info-row row">
                                <div class="col-5 info-label">Mã sinh viên:</div>
                                <div class="col-7" th:text="${sinhVien.maSV}">SV001</div>
                            </div>
                            
                            <div class="info-row row">
                                <div class="col-5 info-label">Họ và tên:</div>
                                <div class="col-7" th:text="${sinhVien.hoTen}">Nguyễn Văn A</div>
                            </div>
                            
                            <div class="info-row row">
                                <div class="col-5 info-label">Ngày sinh:</div>
                                <div class="col-7" th:text="${#temporals.format(sinhVien.ngaySinh, 'dd/MM/yyyy')}">01/01/2000</div>
                            </div>
                            
                            <div class="info-row row">
                                <div class="col-5 info-label">Giới tính:</div>
                                <div class="col-7" th:text="${sinhVien.gioiTinh}">Nam</div>
                            </div>
                            
                            <div class="info-row row">
                                <div class="col-5 info-label">Email:</div>
                                <div class="col-7">
                                    <a th:href="'mailto:' + ${sinhVien.email}" th:text="${sinhVien.email}">email@example.com</a>
                                </div>
                            </div>
                            
                            <div class="info-row row">
                                <div class="col-5 info-label">Số điện thoại:</div>
                                <div class="col-7" th:text="${sinhVien.soDienThoai ?: 'Chưa cập nhật'}">0901234567</div>
                            </div>
                            
                            <div class="info-row row">
                                <div class="col-5 info-label">Địa chỉ:</div>
                                <div class="col-7" th:text="${sinhVien.diaChi ?: 'Chưa cập nhật'}">Hà Nội</div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <h5 class="mb-3"><i class="bi bi-mortarboard me-2"></i>Thông tin học tập</h5>
                            
                            <div class="info-row row">
                                <div class="col-5 info-label">Khoa:</div>
                                <div class="col-7" th:text="${sinhVien.tenKhoa}">Công nghệ thông tin</div>
                            </div>
                            
                            <div class="info-row row">
                                <div class="col-5 info-label">Lớp:</div>
                                <div class="col-7" th:text="${sinhVien.tenLop}">CNTT1</div>
                            </div>
                            
                            <div class="info-row row">
                                <div class="col-5 info-label">GPA:</div>
                                <div class="col-7">
                                    <span class="badge bg-primary fs-6" 
                                          th:text="${sinhVien.gpa != null ? #numbers.formatDecimal(sinhVien.gpa, 1, 2) : 'Chưa có'}">
                                        3.50
                                    </span>
                                </div>
                            </div>
                            
                            <div class="info-row row">
                                <div class="col-5 info-label">Trạng thái:</div>
                                <div class="col-7">
                                    <span class="badge fs-6" 
                                          th:classappend="${sinhVien.trangThai == 'DANG_HOC' ? 'bg-success' : 
                                                          sinhVien.trangThai == 'TOT_NGHIEP' ? 'bg-info' : 
                                                          sinhVien.trangThai == 'BAO_LUU' ? 'bg-warning' : 'bg-secondary'}"
                                          th:text="${sinhVien.trangThai}">
                                        DANG_HOC
                                    </span>
                                </div>
                            </div>
                            
                            <div class="info-row row">
                                <div class="col-5 info-label">Ngày tạo:</div>
                                <div class="col-7" th:text="${sinhVien.createdAt != null ? #temporals.format(sinhVien.createdAt, 'dd/MM/yyyy HH:mm') : 'N/A'}">01/01/2024 10:00</div>
                            </div>
                            
                            <div class="info-row row">
                                <div class="col-5 info-label">Cập nhật lần cuối:</div>
                                <div class="col-7" th:text="${sinhVien.updatedAt != null ? #temporals.format(sinhVien.updatedAt, 'dd/MM/yyyy HH:mm') : 'N/A'}">01/01/2024 10:00</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="d-flex justify-content-end gap-2 mt-4 pt-3" style="border-top: 1px solid #f0f0f0;">
                        <a href="/sinhvien" class="btn btn-secondary">
                            <i class="bi bi-arrow-left"></i> Quay lại
                        </a>
                        <a th:href="@{/sinhvien/edit/{id}(id=${sinhVien.maSV})}" 
                           class="btn btn-warning"
                           sec:authorize="hasRole('ADMIN')">
                            <i class="bi bi-pencil"></i> Sửa
                        </a>
                        <button type="button" class="btn btn-danger delete-btn" 
                                th:data-ma-sv="${sinhVien.maSV}"
                                sec:authorize="hasRole('ADMIN')">
                            <i class="bi bi-trash"></i> Xóa
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Attach event listener to delete button
        document.addEventListener('DOMContentLoaded', function() {
            var deleteBtn = document.querySelector('.delete-btn');
            if (deleteBtn) {
                deleteBtn.addEventListener('click', function() {
                    var maSV = this.getAttribute('data-ma-sv');
                    confirmDelete(maSV);
                });
            }
        });
        
        function confirmDelete(maSV) {
            if (confirm('Bạn có chắc chắn muốn xóa sinh viên ' + maSV + '?')) {
                fetch('/api/sinhvien/' + maSV, { method: 'DELETE' })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert('Xóa thành công!');
                            window.location.href = '/sinhvien';
                        } else {
                            alert('Xóa thất bại: ' + data.message);
                        }
                    })
                    .catch(error => {
                        alert('Có lỗi xảy ra: ' + error);
                    });
            }
        }
    </script>
</body>
</html>
